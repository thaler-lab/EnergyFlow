<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="author" content="Patrick T. Komiske III, Eric M. Metodiev">
  <link rel="canonical" href="https://energyflow.network/docs/emd/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>EMD - EnergyFlow</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../css/eftheme.css" rel="stylesheet" />

  <script>
    // Current page data
    var mkdocs_page_name = "EMD";
    var mkdocs_page_input_path = "docs/emd.md";
    var mkdocs_page_url = "/docs/emd/";
  </script>

  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-122962541-1', 'energyflow.network');
      ga('send', 'pageview');
  </script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
  <a href="../..">
    <div class="eflogo">
      <img src="../../img/eflogowhite.png"  class="eflogo-img"> EnergyFlow
    </div>
  </a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../demos/">Demos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../examples/">Examples</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../faqs/">FAQs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../releases/">Release Notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../news/">News</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Documentation</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../archs/">Architectures</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../datasets/">Datasets</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">EMD</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#emd">emd</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#emds">emds</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#emd_wasserstein">emd_wasserstein</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#emds_wasserstein">emds_wasserstein</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#emd_pot">emd_pot</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#emds_pot">emds_pot</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../efm/">Energy Flow Moments</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../efp/">Energy Flow Polynomials</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../measures/">Measures</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../gen/">Multigraph Generation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../obs/">Observables</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/">Utils</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">EnergyFlow</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>



          <li>Documentation &raquo;</li>



    <li>EMD</li>
    <li class="wy-breadcrumbs-aside">

    </li>
  </ul>

  <hr/>
</div>
          <div role="main">
            <div class="section">

                <h1 id="energy-movers-distance">Energy Mover's Distance</h1>
<video width="100%" autoplay loop controls>
    <source src="https://github.com/pkomiske/EnergyFlow/raw/images/CMS2011AJets_EventSpaceTriangulation.mp4"
            type="video/mp4">
</video>
<p><br></p>
<p>The Energy Mover's Distance (EMD), also known as the Earth Mover's Distance, is
a metric between particle collider events introduced in <a href="https://
arxiv.org/abs/1902.02346">1902.02346</a>. This submodule contains convenient functions for
computing EMDs between individual events and collections of events. The core of
the computation is handled by either the <a href="https://github.com/
pkomiske/Wasserstein">Wasserstein</a> library or the <a href="https://
pot.readthedocs.io">Python Optimal Transport (POT)</a> library, one of which must be installed in order to use this
submodule.</p>
<p>From Eqs. (1.2) and (1.3) in <a href="https://arxiv.org/abs/2004.04159">2004.04159</a>, the
EMD between two events is the minimum ''work'' required to rearrange one event
<span><span class="MathJax_Preview">\mathcal E</span><script type="math/tex">\mathcal E</script></span> into the other <span><span class="MathJax_Preview">\mathcal E'</span><script type="math/tex">\mathcal E'</script></span> by movements of energy <span><span class="MathJax_Preview">f_{ij}</span><script type="math/tex">f_{ij}</script></span> from
particle <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> in one event to particle <span><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span> in the other:</p>
<div>
<div class="MathJax_Preview">\text{EMD}_{\beta,R}(\mathcal E,\mathcal E^\prime)=\min_{\{f_{ij}\ge0\}}\sum_{i=1}^M\sum_{j=1}^{M'}f_{ij}\left(\frac{
\theta_{ij}}{R}\right)^\beta + \left|\sum_{i=1}^ME_i-\sum_{j=1}^{M'}E^\prime_j
\right|,</div>
<script type="math/tex; mode=display">\text{EMD}_{\beta,R}(\mathcal E,\mathcal E^\prime)=\min_{\{f_{ij}\ge0\}}\sum_{i=1}^M\sum_{j=1}^{M'}f_{ij}\left(\frac{
\theta_{ij}}{R}\right)^\beta + \left|\sum_{i=1}^ME_i-\sum_{j=1}^{M'}E^\prime_j
\right|,</script>
</div>
<div>
<div class="MathJax_Preview">\sum_{j=1}^{M'}f_{ij}\le E_i, \quad \sum_{i=1}^Mf_{ij}\le E^\prime_j,
\quad\sum_{i=1}^M\sum_{j=1}^{M'}f_{ij}=E_\text{min},</div>
<script type="math/tex; mode=display">\sum_{j=1}^{M'}f_{ij}\le E_i, \quad \sum_{i=1}^Mf_{ij}\le E^\prime_j,
\quad\sum_{i=1}^M\sum_{j=1}^{M'}f_{ij}=E_\text{min},</script>
</div>
<p>where <span><span class="MathJax_Preview">E_i,E^\prime_j</span><script type="math/tex">E_i,E^\prime_j</script></span> are the energies of the particles in the two events,
<span><span class="MathJax_Preview">\theta_{ij}</span><script type="math/tex">\theta_{ij}</script></span> is an angular distance between particles, and
<span><span class="MathJax_Preview">E_\text{min}=\min\left(\sum_{i=1}^ME_i,\,\sum_{j=1}^{M'}E^\prime_j\right)</span><script type="math/tex">E_\text{min}=\min\left(\sum_{i=1}^ME_i,\,\sum_{j=1}^{M'}E^\prime_j\right)</script></span> is
the smaller of the two total energies. In a hadronic context, transverse momenta
are used instead of energies.</p>
<hr />
<h3 id="emd">emd</h3>
<pre><code class="language-python">energyflow.emd.emd(*args, **kwargs)
</code></pre>
<p>Computes the EMD between two events. The <code>emd</code> function is set equal to
<a href="#emd_wasserstein"><code>emd_wasserstein</code></a> or <a href="#emd_pot"><code>emd_pot</code></a>, with the
former preferred unless the Wasserstein library is not available.</p>
<hr />
<h3 id="emds">emds</h3>
<pre><code class="language-python">energyflow.emd.emds(*args, **kwargs)
</code></pre>
<p>Computes the EMDs between collections of events. The <code>emds</code> function is
set equal to <a href="#emds_wasserstein"><code>emds_wasserstein</code></a> or
<a href="#emds_pot"><code>emds_pot</code></a>, with the former preferred unless the Wasserstein
library is not available.</p>
<hr />
<h3 id="emd_wasserstein">emd_wasserstein</h3>
<pre><code class="language-python">energyflow.emd.emd_wasserstein(ev0, ev1, dists=None, R=1.0, beta=1.0, norm=False, gdim=2, mask=False,
                                         return_flow=False, do_timing=False,
                                         n_iter_max=100000,
                                         epsilon_large_factor=10000.0, epsilon_small_factor=1.0)
</code></pre>
<p>Compute the EMD between two events using the Wasserstein library.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>ev0</strong> : <em>numpy.ndarray</em><ul>
<li>The first event, given as a two-dimensional array. The event is
assumed to be an <code>(M,1+gdim)</code> array of particles, where <code>M</code> is the
multiplicity and <code>gdim</code> is the dimension of the ground space in
which to compute euclidean distances between particles (as specified
by the <code>gdim</code> keyword argument). The zeroth column is the weights of
the particles, typically their energies or transverse momenta. For
typical hadron collider jet applications, each particle will be of
the form <code>(pT,y,phi)</code> where  <code>y</code> is the rapidity and <code>phi</code> is the
azimuthal angle. If <code>dists</code> are provided, then the columns after the
zeroth are ignored; alternatively a one-dimensional array consisting
of just the particle weights may be passed in this case.</li>
</ul>
</li>
<li><strong>ev1</strong> : <em>numpy.ndarray</em><ul>
<li>The other event, same format as <code>ev0</code>.</li>
</ul>
</li>
<li><strong>dists</strong> : <em>numpy.ndarray</em><ul>
<li>A distance matrix between particles in <code>ev0</code> and <code>ev1</code>. If <code>None</code>,
then the columns of the events after the zeroth are taken to be
coordinates and the <code>gdim</code>-dimensional Euclidean distance is used.</li>
</ul>
</li>
<li><strong>R</strong> : <em>float</em><ul>
<li>The R parameter in the EMD definition that controls the relative
importance of the two terms. Must be greater than or equal to half
of the maximum ground distance in the space in order for the EMD
to be a valid metric satisfying the triangle inequality.</li>
</ul>
</li>
<li><strong>beta</strong> : <em>float</em><ul>
<li>The angular weighting exponent. The internal pairwsie distance
matrix is raised to this power prior to solving the optimal
transport problem.</li>
</ul>
</li>
<li><strong>norm</strong> : <em>bool</em><ul>
<li>Whether or not to normalize the particle weights to sum to one
prior to computing the EMD.</li>
</ul>
</li>
<li><strong>gdim</strong> : <em>int</em><ul>
<li>The dimension of the ground metric space. Useful for restricting
which dimensions are considered part of the ground space when using
the internal euclidean distances between particles. Has no effect if
<code>dists</code> are provided.</li>
</ul>
</li>
<li><strong>return_flow</strong> : <em>bool</em><ul>
<li>Whether or not to return the flow matrix describing the optimal
transport found during the computation of the EMD. Note that since
the second term in Eq. 1 is implemented by including an additional
particle in the event with lesser total weight, this will be
reflected in the flow matrix.</li>
</ul>
</li>
<li><strong>mask</strong> : <em>bool</em><ul>
<li>If <code>True</code>, masks out particles farther than <code>R</code> away from the
origin. Has no effect if <code>dists</code> are provided.</li>
</ul>
</li>
<li><strong>n_iter_max</strong> : <em>int</em><ul>
<li>Maximum number of iterations for solving the optimal transport
problem.</li>
</ul>
</li>
<li><strong>epsilon_large_factor</strong> : <em>float</em><ul>
<li>Controls some tolerances in the optimal transport solver. This
value is multiplied by the floating points epsilon (around 1e-16 for
64-bit floats) to determine the actual tolerance.</li>
</ul>
</li>
<li><strong>epsilon_small_factor</strong> : <em>float</em><ul>
<li>Analogous to <code>epsilon_large_factor</code> but used where the numerical
tolerance can be stricter.</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li><em>float</em><ul>
<li>The EMD value.</li>
</ul>
</li>
<li>[<em>numpy.ndarray</em>], optional<ul>
<li>The flow matrix found while solving for the EMD. The <code>(i,j)</code>th
entry is the amount of <code>pT</code> that flows between particle i in <code>ev0</code>
and particle j in <code>ev1</code>.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="emds_wasserstein">emds_wasserstein</h3>
<pre><code class="language-python">energyflow.emd.emds_wasserstein(events0, events1=None, R=1.0, beta=1.0, norm=False, gdim=2, mask=False,
                                                       external_emd_handler=None,
                                                       n_jobs=-1, print_every=0, verbose=0,
                                                       throw_on_error=True, n_iter_max=100000,
                                                       epsilon_large_factor=10000.0,
                                                       epsilon_small_factor=1.0)
</code></pre>
<p>Compute the EMDs between collections of events. This can be used to
 compute EMDs between all pairs of events in a set or between events in
 two different sets.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>events0</strong> : <em>list</em><ul>
<li>Iterable collection of events. Each event is assumed to be an
 <code>(M,1+gdim)</code> array of particles, where <code>M</code> is the multiplicity and
 <code>gdim</code> is the dimension of the ground space in which to compute
 euclidean distances between particles (as specified by the <code>gdim</code>
 keyword argument). The zeroth column is the weights of the
 particles, typically their energies or transverse momenta. For
 typical hadron collider jet applications, each particle will be of
 the form <code>(pT,y,phi)</code> where  <code>y</code> is the rapidity and <code>phi</code> is the
 azimuthal angle. If <code>dists</code> are provided, then the columns after the
 zeroth are ignored; alternatively a one-dimensional array consisting
 of just the particle weights may be passed in this case.</li>
</ul>
</li>
<li><strong>events1</strong> : <em>list</em> or <code>None</code><ul>
<li>Iterable collection of events in the same format as <code>events0</code>, or
 <code>None</code>. If the latter, the pairwise distances between events in
 <code>events0</code> will be computed and the returned matrix will be
 symmetric.</li>
</ul>
</li>
<li><strong>R</strong> : <em>float</em><ul>
<li>The R parameter in the EMD definition that controls the relative
 importance of the two terms. Must be greater than or equal to half
 of the maximum ground distance in the space in order for the EMD
 to be a valid metric satisfying the triangle inequality.</li>
</ul>
</li>
<li><strong>norm</strong> : <em>bool</em><ul>
<li>Whether or not to normalize the particle weights to sum to one
 prior to computing the EMD.</li>
</ul>
</li>
<li><strong>beta</strong> : <em>float</em><ul>
<li>The angular weighting exponent. The internal pairwsie distance
 matrix is raised to this power prior to solving the optimal
 transport problem.</li>
</ul>
</li>
<li><strong>gdim</strong> : <em>int</em><ul>
<li>The dimension of the ground metric space. Useful for restricting
 which dimensions are considered part of the ground space when using
 the internal euclidean distances between particles.</li>
</ul>
</li>
<li><strong>mask</strong> : <em>bool</em><ul>
<li>If <code>True</code>, ignores particles farther than <code>R</code> away from the
 origin.</li>
</ul>
</li>
<li><strong>external_emd_handler</strong> : <em>wasserstein.ExternalEMDHandler</em><ul>
<li>An instance of an external EMD handler from the wasserstein
 module, e.g. <code>CorrelationDimension</code>.</li>
</ul>
</li>
<li><strong>n_jobs</strong> : <em>int</em> or <code>None</code><ul>
<li>The number of cpu cores to use. A value of <code>None</code> or <code>-1</code> will use
 as many threads as there are CPUs on the machine.</li>
</ul>
</li>
<li><strong>print_every</strong> : <em>int</em><ul>
<li>The number of computations to do in between printing the
 progress. Even if the verbosity level is zero, this still plays a
 role in determining when the worker threads report the results
 back to the main thread and check for interrupt signals.</li>
</ul>
</li>
<li><strong>verbose</strong> : <em>int</em><ul>
<li>Controls the verbosity level. A value greater than <code>0</code> will print
 the progress of the computation at intervals specified by
 <code>print_every</code>.</li>
</ul>
</li>
<li><strong>throw_on_error</strong> : <em>bool</em><ul>
<li>Whether or not to raise an exception when an issue is encountered.
 Can be useful when debugging.</li>
</ul>
</li>
<li><strong>n_iter_max</strong> : <em>int</em><ul>
<li>Maximum number of iterations for solving the optimal transport
 problem.</li>
</ul>
</li>
<li><strong>epsilon_large_factor</strong> : <em>float</em><ul>
<li>Controls some tolerances in the optimal transport solver. This
 value is multiplied by the floating points epsilon (around 1e-16 for
 64-bit floats) to determine the actual tolerance.</li>
</ul>
</li>
<li><strong>epsilon_small_factor</strong> : <em>float</em><ul>
<li>Analogous to <code>epsilon_large_factor</code> but used where the numerical
 tolerance can be stricter.</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li><em>numpy.ndarray</em><ul>
<li>The EMD values as a two-dimensional array, except if an external
 EMD handler was provided, in which case no value is returned. If
 <code>events1</code> was <code>None</code>, then the shape will be <code>(len(events0),
 len(events0))</code> and the array will be symmetric, otherwise it will
 have shape <code>(len(events0), len(events1))</code>.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="emd_pot">emd_pot</h3>
<pre><code class="language-python">energyflow.emd.emd_pot(ev0, ev1, R=1.0, norm=False, beta=1.0, measure='euclidean', coords='hadronic',
                                 return_flow=False, gdim=None, mask=False, n_iter_max=100000,
                                 periodic_phi=False, phi_col=2, empty_policy='error')
</code></pre>
<p>Compute the EMD between two events using the Python Optimal
Transport library.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>ev0</strong> : <em>numpy.ndarray</em><ul>
<li>The first event, given as a two-dimensional array. The event is
assumed to be an <code>(M,1+gdim)</code> array of particles, where <code>M</code> is the
multiplicity and <code>gdim</code> is the dimension of the ground space in
which to compute euclidean distances between particles (as specified
by the <code>gdim</code> keyword argument. The zeroth column is assumed to be
the energies (or equivalently, the transverse momenta) of the
particles. For typical hadron collider jet applications, each
particle will be of the form <code>(pT,y,phi)</code> where  <code>y</code> is the rapidity
and <code>phi</code> is the azimuthal angle.</li>
</ul>
</li>
<li><strong>ev1</strong> : <em>numpy.ndarray</em><ul>
<li>The other event, same format as <code>ev0</code>.</li>
</ul>
</li>
<li><strong>R</strong> : <em>float</em><ul>
<li>The R parameter in the EMD definition that controls the relative
importance of the two terms. Must be greater than or equal to half
of the maximum ground distance in the space in order for the EMD
to be a valid metric satisfying the triangle inequality.</li>
</ul>
</li>
<li><strong>beta</strong> : <em>float</em><ul>
<li>The angular weighting exponent. The internal pairwsie distance
matrix is raised to this power prior to solving the optimal
transport problem.</li>
</ul>
</li>
<li><strong>norm</strong> : <em>bool</em><ul>
<li>Whether or not to normalize the pT values of the events prior to
computing the EMD.</li>
</ul>
</li>
<li><strong>measure</strong> : <em>str</em><ul>
<li>Controls which metric is used to calculate the ground distances
between particles. <code>'euclidean'</code> uses the euclidean metric in
however many dimensions are provided and specified by <code>gdim</code>.
<code>'spherical'</code> uses the opening angle between particles on the
sphere (note that this is not fully tested and should be used
cautiously).</li>
</ul>
</li>
<li><strong>coords</strong> : <em>str</em><ul>
<li>Only has an effect if <code>measure='spherical'</code>, in which case it
controls if <code>'hadronic'</code> coordinates <code>(pT,y,phi,[m])</code> are expected
versus <code>'cartesian'</code> coordinates <code>(E,px,py,pz)</code>.</li>
</ul>
</li>
<li><strong>return_flow</strong> : <em>bool</em><ul>
<li>Whether or not to return the flow matrix describing the optimal
transport found during the computation of the EMD. Note that since
the second term in Eq. 1 is implemented by including an additional
particle in the event with lesser total pT, this will be reflected
in the flow matrix.</li>
</ul>
</li>
<li><strong>gdim</strong> : <em>int</em><ul>
<li>The dimension of the ground metric space. Useful for restricting
which dimensions are considered part of the ground space. Can be
larger than the number of dimensions present in the events (in
which case all dimensions will be included). If <code>None</code>, has no
effect.</li>
</ul>
</li>
<li><strong>mask</strong> : <em>bool</em><ul>
<li>If <code>True</code>, ignores particles farther than <code>R</code> away from the
origin.</li>
</ul>
</li>
<li><strong>n_iter_max</strong> : <em>int</em><ul>
<li>Maximum number of iterations for solving the optimal transport
problem.</li>
</ul>
</li>
<li><strong>periodic_phi</strong> : <em>bool</em><ul>
<li>Whether to expect (and therefore properly handle) periodicity
in the coordinate corresponding to the azimuthal angle <span><span class="MathJax_Preview">\phi</span><script type="math/tex">\phi</script></span>.
Should typically be <code>True</code> for event-level applications but can
be set to <code>False</code> (which is slightly faster) for jet applications
where all <span><span class="MathJax_Preview">\phi</span><script type="math/tex">\phi</script></span> differences are less than or equal to <span><span class="MathJax_Preview">\pi</span><script type="math/tex">\pi</script></span>.</li>
</ul>
</li>
<li><strong>phi_col</strong> : <em>int</em><ul>
<li>The index of the column of <span><span class="MathJax_Preview">\phi</span><script type="math/tex">\phi</script></span> values in the event array.</li>
</ul>
</li>
<li><strong>empty_policy</strong> : <em>float</em> or <code>'error'</code><ul>
<li>Controls behavior if an empty event is passed in. When set to
<code>'error'</code>, a <code>ValueError</code> is raised if an empty event is
encountered. If set to a float, that value is returned is returned
instead on an empty event.</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li><em>float</em><ul>
<li>The EMD value.</li>
</ul>
</li>
<li>[<em>numpy.ndarray</em>], optional<ul>
<li>The flow matrix found while solving for the EMD. The <code>(i,j)</code>th
entry is the amount of <code>pT</code> that flows between particle i in <code>ev0</code>
and particle j in <code>ev1</code>.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="emds_pot">emds_pot</h3>
<pre><code class="language-python">energyflow.emd.emds_pot(X0, X1=None, R=1.0, norm=False, beta=1.0, measure='euclidean', coords='hadronic',
                            gdim=None, mask=False, n_iter_max=100000,
                            periodic_phi=False, phi_col=2, empty_policy='error',
                            n_jobs=None, verbose=0, print_every=10**6)
</code></pre>
<p>Compute the EMDs between collections of events. This can be used to
 compute EMDs between all pairs of events in a set or between events in
 two different sets.</p>
<p><strong>Arguments</strong></p>
<ul>
<li><strong>X0</strong> : <em>list</em><ul>
<li>Iterable collection of events. Each event is assumed to be an
 <code>(M,1+gdim)</code> array of particles, where <code>M</code> is the multiplicity and
 <code>gdim</code> is the dimension of the ground space in which to compute
 euclidean distances between particles (specified by the <code>gdim</code>
 keyword argument). The zeroth column is assumed to be the energies
 (or equivalently, the transverse momenta) of the particles. For
 typical hadron collider jet applications, each particle will be of
 the form <code>(pT,y,phi)</code> where  <code>y</code> is the rapidity and <code>phi</code> is the
 azimuthal angle.</li>
</ul>
</li>
<li><strong>X1</strong> : <em>list</em> or <code>None</code><ul>
<li>Iterable collection of events in the same format as <code>X0</code>,
 or <code>None</code>. If the latter, the pairwise distances between events
 in <code>X0</code> will be computed and the returned matrix will be symmetric.</li>
</ul>
</li>
<li><strong>R</strong> : <em>float</em><ul>
<li>The R parameter in the EMD definition that controls the relative
 importance of the two terms. Must be greater than or equal to half
 of the maximum ground distance in the space in order for the EMD
 to be a valid metric satisfying the triangle inequality.</li>
</ul>
</li>
<li><strong>norm</strong> : <em>bool</em><ul>
<li>Whether or not to normalize the pT values of the events prior to
 computing the EMD.</li>
</ul>
</li>
<li><strong>beta</strong> : <em>float</em><ul>
<li>The angular weighting exponent. The internal pairwsie distance
 matrix is raised to this power prior to solving the optimal
 transport problem.</li>
</ul>
</li>
<li><strong>measure</strong> : <em>str</em><ul>
<li>Controls which metric is used to calculate the ground distances
 between particles. <code>'euclidean'</code> uses the euclidean metric in
 however many dimensions are provided and specified by <code>gdim</code>.
 <code>'spherical'</code> uses the opening angle between particles on the
 sphere (note that this is not fully tested and should be used
 cautiously).</li>
</ul>
</li>
<li><strong>coords</strong> : <em>str</em><ul>
<li>Only has an effect if <code>measure='spherical'</code>, in which case it
 controls if <code>'hadronic'</code> coordinates <code>(pT,y,phi,[m])</code> are expected
 versus <code>'cartesian'</code> coordinates <code>(E,px,py,pz)</code>.</li>
</ul>
</li>
<li><strong>gdim</strong> : <em>int</em><ul>
<li>The dimension of the ground metric space. Useful for restricting
 which dimensions are considered part of the ground space. Can be
 larger than the number of dimensions present in the events (in
 which case all dimensions will be included). If <code>None</code>, has no
 effect.</li>
</ul>
</li>
<li><strong>mask</strong> : <em>bool</em><ul>
<li>If <code>True</code>, ignores particles farther than <code>R</code> away from the
 origin.</li>
</ul>
</li>
<li><strong>n_iter_max</strong> : <em>int</em><ul>
<li>Maximum number of iterations for solving the optimal transport
 problem.</li>
</ul>
</li>
<li><strong>periodic_phi</strong> : <em>bool</em><ul>
<li>Whether to expect (and therefore properly handle) periodicity
 in the coordinate corresponding to the azimuthal angle <span><span class="MathJax_Preview">\phi</span><script type="math/tex">\phi</script></span>.
 Should typically be <code>True</code> for event-level applications but can
 be set to <code>False</code> (which is slightly faster) for jet applications
 where all <span><span class="MathJax_Preview">\phi</span><script type="math/tex">\phi</script></span> differences are less than or equal to <span><span class="MathJax_Preview">\pi</span><script type="math/tex">\pi</script></span>.</li>
</ul>
</li>
<li><strong>phi_col</strong> : <em>int</em><ul>
<li>The index of the column of <span><span class="MathJax_Preview">\phi</span><script type="math/tex">\phi</script></span> values in the event array.</li>
</ul>
</li>
<li><strong>empty_policy</strong> : <em>float</em> or <code>'error'</code><ul>
<li>Controls behavior if an empty event is passed in. When set to
 <code>'error'</code>, a <code>ValueError</code> is raised if an empty event is
 encountered. If set to a float, that value is returned is returned
 instead on an empty event.</li>
</ul>
</li>
<li><strong>n_jobs</strong> : <em>int</em> or <code>None</code><ul>
<li>The number of worker processes to use. A value of <code>None</code> will use
 as many processes as there are CPUs on the machine. Note that for
 smaller numbers of events, a smaller value of <code>n_jobs</code> can be
 faster.</li>
</ul>
</li>
<li><strong>verbose</strong> : <em>int</em><ul>
<li>Controls the verbosity level. A value greater than <code>0</code> will print
 the progress of the computation at intervals specified by
 <code>print_every</code>.</li>
</ul>
</li>
<li><strong>print_every</strong> : <em>int</em><ul>
<li>The number of computations to do in between printing the
 progress. Even if the verbosity level is zero, this still plays a
 role in determining when the worker processes report the results
 back to the main process.</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li><em>numpy.ndarray</em><ul>
<li>The EMD values as a two-dimensional array. If <code>X1</code> was <code>None</code>,
 then the shape will be <code>(len(X0), len(X0))</code> and the array will be
 symmetric, otherwise it will have shape <code>(len(X0), len(X1))</code>.</li>
</ul>
</li>
</ul>
<hr />

            </div>
          </div>
          <footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">

        <a href="../efm/" class="btn btn-neutral float-right" title="Energy Flow Moments">Next <span class="icon icon-circle-arrow-right"></span></a>


        <a href="../datasets/" class="btn btn-neutral" title="Datasets"><span class="icon icon-circle-arrow-left"></span> Previous</a>

    </div>


  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->

      <p>Copyright (C) 2017-2024 EnergyFlow Authors</p>

  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">

          <a href="https://github.com/pkomiske/EnergyFlow" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>


        <span><a href="../datasets/" style="color: #fcfcfc;">&laquo; Previous</a></span>


        <span style="margin-left: 15px"><a href="../efm/" style="color: #fcfcfc">Next &raquo;</a></span>

    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/eftheme.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
